---
title: "На небе только и разговоров, что о виртуалках и базах данных: тест на знание облачных технологий"
collection: publications
permalink: /publication/2020-01-12-paper-title-number-2
excerpt: 'This paper is about the number 2. The number 3 is left for future work.'
date: 2020-01-12
venue: 'Journal 1'
paperurl: 'https://habr.com/ru/article/462261/'
citation: 'Your Name, You. (2010). &quot;Paper Title Number 2.&quot; <i>Journal 1</i>. 1(2).'
---
Об облаках сегодня не говорит и не рассуждает только ленивый. Просто говорить — это одно, а вот иметь твердые знания и реальные навыки — совсем другое дело. Команда Яндекс.Облака, которому сегодня исполняется год, предлагает проверить, насколько хорошо вы разбираетесь в облачных сервисах и соответствуете текущим запросам рынка. [Ну что, поехали?](https://habr.com/ru/article/462261/)


Эта колоночная СУБД с открытым кодом легко выполняет в реальном времени аналитические запросы на структурированных больших данных и может работать в 100-1000 раз быстрее других. К ней можно [подключиться](https://u.tmtm.ru/yandexcloud11q) в Яндекс.Облаке.


Эта СУБД подойдет для систем построения рейтингов и анализа контента в реальном времени, но не для быстрого анализа больших данных. К такой можно [подключиться](https://u.tmtm.ru/yandexcloud11q) уже сейчас в Яндекс.Облаке.


Эта СУБД не может развивать подобную скорость, но она подойдет для работы с документами и разработки приложений без большого числа связей. К такой СУБД можно [подключиться](https://u.tmtm.ru/yandexcloud11q) в Яндекс.Облаке.
        

У команды [Яндекс.Облака](https://u.tmtm.ru/yandexcloud) есть [Telеgram-канал](https://u.tmtm.ru/yandexcloudnews), который помогает новичкам разобраться в функциях облачных сервисов и предлагает пошаговые инструкции для их внедрения.

  
Базовые знания у вас есть. Но до гордого звания профессионала ещё трудиться и трудиться. Команда [Яндекс.Облака](https://u.tmtm.ru/yandexcloud) охотно делится знаниями в [Telegram](https://u.tmtm.ru/yandexcloudnews) и на [YouTube](https://u.tmtm.ru/yandexcloudyoutube). Думаем, вам было бы полезно почитать и посмотреть.  

Узнавайте последние новости на [сайте Яндекс.Облака](https://u.tmtm.ru/yandexcloud) или в [Telegram](https://u.tmtm.ru/yandexcloudnews) и [YouTube](https://u.tmtm.ru/yandexcloudyoutube).

В конце прошлого года Яндекс запустил новый продукт для разработчиков — [Яндекс.Облако](https://cloud.yandex.ru/), который предоставляет вычислительные мощности и сопутствующие сервисы для обработки и хранения данных. В этой статье я расскажу о том, как мы оценивали перенос одного из наших проектов на Облако, о его особенностях и тарифах.  

![](https://habrastorage.org/getpro/tmtm/articles/tld/images/6775805/tild3937-6431-4636-a538-643735353336__r3.png) 

Развернуть свой веб-сервис или мобильное приложение можно двумя способами. Рассмотрим на примере базы данных (как одной из частей веб-сервиса):   

* **Self-managed** — арендуем машину и разворачиваем на ней свой PostgreSQL. У своего постгреса есть и плюсы, и минусы: если нагрузки маленькие, то такого решения будет достаточно. Но чем больше объемы, тем больше нужно обслуживания, и в какой-то момент для этого понадобится отдельный DevOps инженер.
* **Fully-managed** — выбираем облачного провайдера и пользуемся PostgreSQL как сервисом. В этом случае облачный провайдер берет на себя поддержку всей инфраструктуры и гарантирует, что все будет работать в соответствии с [SLA](https://en.wikipedia.org/wiki/Service-level_agreement) (соглашение об уровне предоставления услуги, которое ограничивает _максимальное время недоступности, максимальное суммарное время недоступности за период_). Никаких проблем с поддержкой инфраструктуры не возникает.  

Тем, кто выбирает облачный вариант, знакома тройка крупных поставщиков услуг: [Microsoft Azure](https://azure.microsoft.com/), [Amazon Web Services (AWS)](https://aws.amazon.com/) и [Google Cloud](https://cloud.google.com/). Они предоставляют неограниченное количество виртуальных машин и десятки удобных сервисов, а из трех вариантов можно выбрать подходящее по цене решение. Мы обычно работаем с AWS, которые в последнее время обладают несколькими неудобствами при использовании в России.  

Первая особенность AWS в России связана с активными блокировками РКН, от которых в 2018 году пострадали многие сервисы, от стартапов до банковских систем ([Viber, Skyeng и другие](https://vc.ru/flood/36456-hronika-kto-popal-pod-blokirovku-vmeste-s-telegram)).  

Вдобавок к этому, с начала 2019 года Амазон [начал взимать](https://aws.amazon.com/ru/tax-help/russia/) с российских компаний НДС (20% от цены) за использование своих облачных решений. В этом нет специфики конкретно Амазона: НДС уже собирают и Майкрософт, и Гугл, и другие иностранные интернет-компании, однако это в любом случае неприятный для компаний росты цены за привычный набор услуг.  

Помимо известных международных компаний есть и российский рынок облачных систем: платформа [Mail.Ru Cloud Solutions](https://mcs.mail.ru/), [Селектел](https://selectel.ru/) и отдельные меньшие по размеру игроки. Пока многие предоставляют только аренду железа, что не равно облачным вычислениям. Полноценное облако предоставляет не только аренду машин, но и набор сопроводительных сервисов для упрощения инфраструктуры (например, таких, как управляемые базы данных).  

### Российский рынок  

В России полноценных облачных решений мало (а именно, два): MCS от мейл.ру и недавно запущенное [Яндекс.Облако](http://cloud.yandex.ru/).  

Яндекс подходит к вопросу предоставления услуг уже с тем, чтобы давать в аренду экосистему услуг. Облако из коробки предлагает не так много сервисов, как в AWS: вычислительные машины, хранилище данных, базы данных, балансировщик нагрузки (альфа), оркестрацию контейнеров (альфа), в планах добавление serverless платформы. Предлагаемый набор сервисов позволяет проектировать и масштабировать большое количество бизнес-решений быстрее, чем на собственной инфраструктуре, а количество сервисов еще и постоянно увеличивается. У Облака три дата-центра, благодаря чему можно создавать географически распределенные системы.  

В конце 2018 года Облако запустилось публично и сначала открыло подключение по партнерской программе (в которой [мы](https://potehalabs.com/ru) стали одними из первых партнеров), а с [7 декабря 2018](https://habr.com/ru/company/yandex/blog/432042/) стало доступным для всех. При подключении сейчас Облако дает пользователям грант на знакомство — [4000 рублей на 2 месяца](https://cloud.yandex.ru/prices). Благодаря раннему доступу мы посмотрели возможности, тарифы и сделали расчеты для переноса одного из наших сервисов с AWS на Облако.  

### Архитектура  

Сейчас наш веб-сервис работает в продакшне на AWS и состоит из двух компонентов: фронта и бека, поэтому рассмотрим перенос на Облако покомпонентно. Мигрируем приложение со следующим стеком технологий:  

 — **Frontend**. Написан на Реакте, рендеринг происходит на клиенте. Статические файлы (html, скрипты и стили) хранятся на Simple Storage Service (S3).![Архитектура фронтенда на AWS](https://habrastorage.org/webt/0f/or/gq/0forgqeox8rhmdvmyto_vz-krw4.jpeg)  

 — **Backend**. Django-приложение, которое запускается в докер-контейнерах на виртуальных машинах Elastic Compute Cloud (EC2). Машины находятся под управлением Elastic Container Service (ECS, бесплатный оркестратор контейнеров), для баз данных используем PostgreSQL в Relational Database Service (RDS). Для балансировки нагрузки — Elastic Load Balancer (ELB).![Архитектура бекенда на AWS](https://habrastorage.org/webt/61/cm/a0/61cma02fgqcbpa1w1b94xdxerky.jpeg)  

Деплой приложения делаем через GitLab CI, используя AWS CLI для обновления сервиса на ECS и статики на S3.  

Как архитектура сервиса будет выглядеть на Яндекс.Облаке:  

 — **Frontend**. Вместо S3 используется Yandex Object Storage, с которого можно также раздавать статику сайта.![Архитектура фронтенда на Яндекс.Облаке](https://habrastorage.org/webt/rg/rx/hg/rgrxhgth9iwtiucnq_8jr5cwr08.jpeg)  

 — **Backend**. Вместо EC2 используется Yandex Compute Cloud, которое устроено похоже: тоже есть блочное хранилище, которое существует отдельно от машин. Готового к использованию аналога ECS у Облака сейчас нет (но в альфа-версии есть Yandex Instance Groups, на основе которых обещают представить управляемый сервис контейнеров). Поэтому пока вместо ECS надо использовать Kubernetes или Rancher, который нужно развернуть самому. Балансировщик Yandex Load Balancer в Облаке тоже в альфе, поэтому пока в качестве балансировщика можно использовать nginx, поднятый на отдельной машине. Для PostgreSQL у Облака есть Yandex Managed Service for PostgreSQL.![Архитектура бэкенда на Яндекс.Облаке](https://habrastorage.org/webt/ji/sg/h-/jisgh-eaukttdx3nrpggc7yahhw.jpeg)  

### Оценка стоимости  

([Oфициальные тарифы здесь](https://cloud.yandex.ru/prices)).

### Особенности сервисов Яндекс.Облака  

* Yandex Compute Cloud отличается от EC2 тем, что на EC2 можно увеличивать мощность машины по RAM и CPU только одновременно, а в Облаке они независимы (на каждый vCPU можно выбирать от 1 до 8 GB RAM), что дает больше гибкости.
* Yandex Object Storage совместимо с API S3. Из минусов, пока нельзя настроить https-сертификат на свой домен. Проблема решается использованием сертификата Cloudflare, тогда трафик от пользователя к внешнему слою API будет защищён. Это быстрый и простой вариант. Также можно настроить server-side рендеринг, так что ждём, когда Облако добавит такую возможность.
* В Облаке пока нет сервиса для асинхронного централизованного сбора логов (аналога AWS CloudWatch), поэтому для сбора и анализа логов необходимо подключать сторонние решения.
* Управление доступом к ресурсам: на AWS это делается через роли, которые создаются в сервисе Identity and Access Management (IAM) и автоматически назначаются всем инстансам внутри ECS кластера. В Облаке тоже есть свой [IAM](https://cloud.yandex.ru/services/iam), но настолько же гранулированные права, как в AWS, в нём пока недоступны.
* Пока отсутствуют GPU машины для вычислений.  

### Заключение  

В заключение выделим причины попробовать Облако от Яндекса:   

* Потенциально большой набор инфраструктурных сервисов;
* Для части сервисов доступен AWS-совместимый API, что значительно упрощает переход;
* Тарифы ниже, чем у западных аналогов, нет завязки на курс доллара;
* Защита от внезапных блокировок;
* Дата-центр в России, благодаря чему закон о защите персональных данных пользователей всегда выполняется.  

На 2019 год у Облака большие планы по релизам заявленных сервисов и добавлению новых. Думаем, что с таким набором возможностей и тарифами оно сможет стать сильным конкурентом Амазона на российском рынке.
